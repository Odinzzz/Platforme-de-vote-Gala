{% extends "base.html" %}

{% block content %}
<div class="row g-4">
    <div class="col-lg-4">
        <div class="card shadow-sm h-100">
            <div class="card-body">
                <h1 class="h5 mb-1">Participants</h1>
                <p class="text-muted small mb-3">Visualisez les inscriptions par categorie, filtrez par gala et explorez les reponses soumises.</p>
                <div class="mb-3">
                    <label class="form-label" for="participantsGalaSelect">Gala</label>
                    <select class="form-select" id="participantsGalaSelect">
                        <option value="">Tous les galas</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label" for="participantsCategorieSelect">Categorie</label>
                    <select class="form-select" id="participantsCategorieSelect" disabled>
                        <option value="">Toutes les categories</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label" for="participantsSearchInput">Recherche</label>
                    <input class="form-control" id="participantsSearchInput" type="search" placeholder="Nom, courriel, responsable...">
                </div>
                <div class="form-check form-switch mb-0">
                    <input class="form-check-input" type="checkbox" id="participantsMissingOnlySwitch">
                    <label class="form-check-label" for="participantsMissingOnlySwitch">Afficher seulement les reponses incompletes</label>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-8">
        <div class="card shadow-sm">
            <div class="card-body">
                <div class="d-flex flex-wrap justify-content-between align-items-start gap-2">
                    <div>
                        <h2 class="h5 mb-1">Inscriptions</h2>
                        <p class="text-muted small mb-0" id="participantsSubtitle">Selectionnez un gala pour affiner les resultats.</p>
                    </div>
                    <div class="d-flex align-items-center gap-2">
                        <div class="btn-group" role="group" aria-label="Switcher de vue">
                            <button class="btn btn-outline-secondary btn-sm active" type="button" id="participantsViewCardsButton" data-view="cards">Cartes</button>
                            <button class="btn btn-outline-secondary btn-sm" type="button" id="participantsViewTableButton" data-view="table">Tableau</button>
                        </div>
                        <span class="badge text-bg-light" id="participantsCountBadge">0 participants</span>
                        <button class="btn btn-outline-secondary btn-sm" type="button" id="participantsRefreshButton">
                            <span class="spinner-border spinner-border-sm d-none" id="participantsRefreshSpinner" role="status" aria-hidden="true"></span>
                            <span class="ms-1">Actualiser</span>
                        </button>
                    </div>
                </div>
                <div class="mt-4" id="participantsListContainer">
                    <div class="placeholder-glow" id="participantsLoadingState">
                        <div class="placeholder col-12 mb-3" style="height: 48px;"></div>
                        <div class="placeholder col-10 mb-3" style="height: 48px;"></div>
                        <div class="placeholder col-8" style="height: 48px;"></div>
                    </div>
                    <div class="alert alert-danger d-none" id="participantsErrorState">Une erreur est survenue lors du chargement des participants.</div>
                    <div class="alert alert-info d-none" id="participantsEmptyState">Aucune inscription ne correspond aux filtres actuels.</div>
                    <div class="vstack gap-3" id="participantsList"></div>
                    <div class="table-responsive d-none" id="participantsTableWrapper">
                        <table class="table table-hover align-middle" id="participantsTable">
                            <thead class="table-light">
                                <tr>
                                    <th scope="col">Categorie</th>
                                    <th scope="col" class="text-muted">Segment</th>
                                    <th scope="col">Participant</th>
                                    <th scope="col" class="text-muted">Ville</th>
                                    <th scope="col" class="text-muted">Statut</th>
                                    <th scope="col" class="text-muted">Reponses</th>
                                    <th scope="col" class="text-muted">Actions</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
<div class="modal fade" id="participantResponsesModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="h5 modal-title" id="participantResponsesModalTitle">Modifier les reponses</h2>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
            </div>
            <div class="modal-body">
                <div id="participantResponsesAlert" class="alert d-none" role="alert"></div>
                <div id="participantResponsesBody">
                    <div class="placeholder-glow">
                        <div class="placeholder col-12 mb-2" style="height: 32px;"></div>
                        <div class="placeholder col-12 mb-2" style="height: 80px;"></div>
                        <div class="placeholder col-10" style="height: 80px;"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light" data-bs-dismiss="modal">Fermer</button>
                <button type="button" class="btn btn-primary" id="participantResponsesSaveButton">Enregistrer</button>
            </div>
        </div>
    </div>
</div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/admin_participants.js') }}"></script>
{% endblock %}
