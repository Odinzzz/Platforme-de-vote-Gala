{% extends "base.html" %}

{% block content %}
<div class="row g-4">
    <div class="col-lg-5">
        <div class="card shadow-sm">
            <div class="card-body d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h5 mb-1">Galas</h1>
                    <p class="text-muted small mb-0">Creer, modifier et organiser les galas annuels.</p>
                </div>
                <button class="btn btn-primary" id="openCreateGalaModal">Nouveau gala</button>
            </div>
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0" id="galasTable">
                    <thead class="table-light">
                        <tr>
                            <th scope="col">Nom</th>
                            <th scope="col" class="text-muted">Annee</th>
                            <th scope="col" class="text-muted">Categories</th>
                            <th scope="col" class="text-muted">Statut</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="placeholder-row">
                            <td colspan="4" class="text-muted small">Chargement...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="col-lg-7">
        <div id="galaDetail" class="card shadow-sm">
            <div class="card-body">
                <h2 class="h5 mb-1">Fiche gala</h2>
                <p class="text-muted mb-0">Selectionnez un gala pour afficher les informations et gerer les categories et questions.</p>
            </div>
        </div>
    </div>
</div>

<!-- Create gala modal -->
<div class="modal fade" id="createGalaModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title h5">Nouveau gala</h2>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
            </div>
            <div class="modal-body">
                <div id="createGalaFeedback" class="alert d-none" role="alert"></div>
                <form id="createGalaForm" autocomplete="off">
                    <div class="mb-3">
                        <label class="form-label" for="galaNom">Nom</label>
                        <input class="form-control" id="galaNom" name="nom" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="galaAnnee">Annee</label>
                        <input class="form-control" id="galaAnnee" name="annee" type="number" min="1900" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="galaLieu">Lieu</label>
                        <input class="form-control" id="galaLieu" name="lieu" placeholder="Ville, salle, etc.">
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="galaDate">Date (AAAA-MM-JJ)</label>
                        <input class="form-control" id="galaDate" name="date_gala" placeholder="2025-05-01">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-light" type="button" data-bs-dismiss="modal">Annuler</button>
                <button class="btn btn-primary" type="button" id="submitCreateGala">Enregistrer</button>
            </div>
        </div>
    </div>
</div>

<!-- Add category modal -->
<div class="modal fade" id="addCategoryModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title h5">Associer des categories</h2>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
            </div>
            <div class="modal-body">
                <div id="addCategoryFeedback" class="alert d-none" role="alert"></div>
                <div class="border rounded p-3 mb-3">
                    <h3 class="h6 mb-2">Creer une categorie</h3>
                    <div id="createCategoryFeedback" class="alert d-none" role="alert"></div>
                    <form id="createCategoryForm" class="row g-2" autocomplete="off">
                        <div class="col-md-6">
                            <label class="form-label" for="newCategoryNom">Nom</label>
                            <input class="form-control" id="newCategoryNom" name="nom" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label" for="newCategoryDescription">Description</label>
                            <input class="form-control" id="newCategoryDescription" name="description" placeholder="Facultatif">
                        </div>
                    </form>
                    <div class="text-end">
                        <button class="btn btn-sm btn-outline-primary" type="button" id="submitCreateCategory">Creer et associer</button>
                    </div>
                </div>
                <p class="text-muted small mb-2">Categories existantes</p>
                <div id="availableCategoriesList" class="row g-3"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-light" type="button" data-bs-dismiss="modal">Annuler</button>
                <button class="btn btn-primary" type="button" id="confirmAddCategories">Ajouter</button>
            </div>
        </div>
    </div>
</div>

<!-- Add question modal -->
<div class="modal fade" id="addQuestionModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title h5">Nouvelle question</h2>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
            </div>
            <div class="modal-body">
                <p class="text-muted small" id="questionCategoryContext">Categorie cible</p>
                <div id="addQuestionFeedback" class="alert d-none" role="alert"></div>
                <form id="addQuestionForm" autocomplete="off">
                    <div class="mb-3">
                        <label class="form-label" for="questionTexte">Texte de la question</label>
                        <textarea class="form-control" id="questionTexte" name="texte" rows="3" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="questionPonderation">Ponderation</label>
                        <input class="form-control" id="questionPonderation" name="ponderation" type="number" step="0.1" min="0.1" value="1.0" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-light" type="button" data-bs-dismiss="modal">Annuler</button>
                <button class="btn btn-primary" type="button" id="confirmAddQuestion">Ajouter</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/admin_galas.js') }}"></script>
{% endblock %}
